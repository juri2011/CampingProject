<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper

 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.campingga.mapper.CartMapper">

	<!-- *selectCart : 특정 회원의 주문 번호가 할당되지 않은 모든 상품을 조회하는 쿼리
			1)장바구니에서 특정회원의 주문 번호가 할당되지 않은 모든 상품을 조회
		  	2)'#{id}'에 해당하는 회원의 장바구니에 있는 상품들을 검색
	-->
	<select id="selectCart" resultType="cart">
		select * from cart where
		mem_id = #{id} AND ordernum is null
	</select>

	<!-- *selectCartAllByNumber : 주어진 장바구니 벙호 목록엔 해당하는 모든 상품을 조회하는 쿼리
			1) 주어진 장바구니 번호 목록에 해당하는 모든 상품을 조회
			2)'#{numberList}'에 주언진 장바구니 번호 목록에 대한 검색 수행						
	 -->
	<select id="selectCartAllByNumber" resultType="list" parameterType="list">
		select * from cart where 
		cart_no in #{numberList} 
	</select>
	
	<!-- *selectCartNo : 주어진 장바구니 번호에 해당하는 상품을 조회하는 쿼리
			1) 주어진 장바구니 번호 목록에 해당하는 모든 상품 조회.
			2)'#{cartNo}'에 해당하는 자바구니 번호읜 상품을 검색
	 -->
	<select id="selectCartNo" resultType="cart">
		select * from cart where
		cart_no = #{cartNo} AND ordernum is null
	</select>
	
	<!-- *selectCasrtByCartNo : 주어진 장바구니 번호 목록에 해당하는 상품을 조회하는 쿼리
			1) 주어진 장바구니 번호 목록에 해당하는 상품을 조회.
			2) '#{id}'에 해당하는 회원이 가지고 있는 장바구니에서 '#{numberList}'에 포함된 장바구니 번호의 상품검색.
	 -->
    <select id="selectCartByCartNo" resultType="cart">
		select * from cart where 
		mem_id = #{id} and cart_no in
	    <foreach collection="numberList" item="item" open="(" separator="," close=")">
	          #{item}
	    </foreach>    
	</select>        
	
	<!-- *insertCart : 새로운 상품을 장바구니에 추가하는 쿼리
			1) 새로운 상품을 장바구니에 추가
			2)'cart'테이블에 회원ID(#{memid}), 상품번호(#{goods_no}),옵션명(#{optionName}),
				총가격(#{totalPrice}), 수량(#{quantity}), 상품이름(#{pname})을 추가
	 -->	
	<insert id="insertCart" parameterType="cart" useGeneratedKeys="true"
		keyProperty="cart_no">
		insert into cart(mem_id, goods_no, optionName, totalPrice, quantity, pname)
		values(#{memid},#{goods_no}, #{optionName}, #{totalPrice}, #{quantity}, #{pname})
	</insert>

	<!-- *deleteCart : 장바구니에서 특정 상품을 삭제하는 쿼리 
			1) '#{cart_no}'에 해당하는 장바구니 번호의 상품을 삭제
	-->
	<delete id="deleteCart">
		delete cart where cart_no = #{cart_no}
	</delete>

	<!-- *selectCartCount : 특정 회원의 장바구니에 있는 상품의 수를 조회하는 쿼리 
			1) '#{memid}'에 해당하는 회원의 장바구니에 있는 상품의 수를 검색
	-->
	<select id="selectCartCount" resultType="int">
		select count(*) from
		cart where mem_id = #{memid} AND ordernum is null
	</select>
	
	<!-- updateCart: 장바구니에 있는 특정 상품의 수량을 업데이트하는 쿼리 
			1)'#{id}'에 해당하는 회원의 장바구니에서 '#{cartNo}'에 해당하는 상품의 수량을 업데이트		
	-->
	<update id="updateCart">
		UPDATE cart SET quantity = #{quantity} WHERE mem_id =
		#{id} AND cart_no =
		#{cartNo}
	</update>

	<!-- *updateCartOrderNo :  주문을 완료한 상품의 상태를 변경하는 쿼리 
			1)'#{memberId}'에 해당하는 회원의 장바구니에서 '#{numberList}'에 포함된 장바구니 번호의 상태를
				'2'로 변경하고, '#{orderNo}'로 주문번호를 할당
	-->
	<update id="updateCartOrderNo">
		UPDATE cart SET ordernum=#{orderNo},
			status = '2',
			update_date = SYSDATE()
		 WHERE mem_id = #{memberId}
		 and cart_no in
		<foreach collection="numberList" item="item" open="(" separator="," close=")">
	          #{item}
	    </foreach>    
		 
	</update>

</mapper>